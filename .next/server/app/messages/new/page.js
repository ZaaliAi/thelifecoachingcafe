(()=>{var e={};e.id=8654,e.ids=[8654],e.modules={2408:(e,s,t)=>{Promise.resolve().then(t.bind(t,39658))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3515:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var r=t(61120);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(...e)=>e.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,r.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:d,...c},u)=>(0,r.createElement)("svg",{ref:u,...n,width:s,height:s,stroke:e,strokeWidth:a?24*Number(t)/Number(s):t,className:i("lucide",o),...c},[...d.map(([e,s])=>(0,r.createElement)(e,s)),...Array.isArray(l)?l:[l]])),l=(e,s)=>{let t=(0,r.forwardRef)(({className:t,...n},l)=>(0,r.createElement)(o,{ref:l,iconNode:s,className:i(`lucide-${a(e)}`,t),...n}));return t.displayName=`${e}`,t}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11516:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(82614).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},15560:(e,s,t)=>{Promise.resolve().then(t.bind(t,21608))},18329:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(82614).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21608:(e,s,t)=>{"use strict";t.d(s,{default:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/components/messaging/NewMessageForm.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/components/messaging/NewMessageForm.tsx","default")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},34729:(e,s,t)=>{"use strict";t.d(s,{T:()=>n});var r=t(60687),a=t(43210),i=t(4780);let n=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...s}));n.displayName="Textarea"},37366:e=>{"use strict";e.exports=require("dns")},39658:(e,s,t)=>{"use strict";t.d(s,{default:()=>N});var r=t(60687),a=t(43210),i=t(27605),n=t(63442),o=t(9275),l=t(29523),d=t(34729),c=t(80013),u=t(44493),m=t(11516),p=t(72963),x=t(55817),h=t(18329),f=t(85866),g=t(29867),v=t(16189),y=t(44957);t(79396);var w=t(85814),j=t.n(w);let b=o.z.object({content:o.z.string().min(10,"Message must be at least 10 characters long.").max(2e3,"Message is too long.")});function N(){let[e,s]=(0,a.useState)(!1),[t,o]=(0,a.useState)(null),[w,N]=(0,a.useState)(!0),{toast:C}=(0,g.dj)(),A=(0,v.useRouter)(),k=(0,v.useSearchParams)(),{user:P,loading:R,getFirebaseAuthToken:q}=(0,y.A)(),M=k.get("coachId"),{register:$,handleSubmit:S,formState:{errors:z},reset:_}=(0,i.mN)({resolver:(0,n.u)(b)}),T=async e=>{if(!P||!t)return void C({title:"Error",description:"Cannot send message. User or Recipient missing.",variant:"destructive"});if(P.id===t.id)return void C({title:"Error",description:"You cannot send a message to yourself.",variant:"destructive"});s(!0);try{let r=await q();if(!r){C({title:"Authentication Error",description:"Could not verify your session. Please log in again.",variant:"destructive"}),s(!1);let e=`/messages/new?coachId=${encodeURIComponent(M||"")}`;A.push(`/login?redirect=${encodeURIComponent(e)}`);return}let a=await fetch("/api/send-message",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({recipientId:t.id,content:e.content})});if(!a.ok){let e=await a.json();throw Error(e.error||`HTTP error! status: ${a.status}`)}C({title:"Message Sent!",description:`Your message to ${t.name} has been sent successfully.`}),_();let i=[P.id,t.id].sort().join("_");A.push(`/dashboard/messages/${i}`)}catch(e){console.error("Error sending message via API:",e),C({title:"Send Error",description:e.message||"Could not send your message. Please try again.",variant:"destructive"})}finally{s(!1)}};return R||w?(0,r.jsxs)("div",{className:"flex justify-center items-center h-full min-h-[calc(100vh-200px)]",children:[(0,r.jsx)(m.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,r.jsx)("span",{className:"ml-2",children:"Loading..."})]}):P?t?(0,r.jsxs)(u.Zp,{className:"max-w-xl mx-auto shadow-lg",children:[(0,r.jsxs)(u.aR,{children:[(0,r.jsx)(l.$,{variant:"outline",size:"sm",asChild:!0,className:"w-fit mb-4",children:(0,r.jsxs)(j(),{href:M?`/coach/${encodeURIComponent(M)}`:"/browse-coaches",children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Back to ",t.name?`${t.name.split(" ")[0]}'s Profile`:"Coaches"]})}),(0,r.jsxs)(u.ZB,{className:"text-2xl flex items-center",children:[(0,r.jsx)(h.A,{className:"mr-3 h-7 w-7 text-primary"}),"Send a Message to ",t.name]}),(0,r.jsx)(u.BT,{children:"Compose your message below. The coach will be notified and can reply via the platform."})]}),(0,r.jsxs)("form",{onSubmit:S(T),children:[(0,r.jsx)(u.Wu,{className:"space-y-6",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c.J,{htmlFor:"content",children:"Your Message"}),(0,r.jsx)(d.T,{id:"content",...$("content"),rows:8,placeholder:`Type your message to ${t.name} here...`,className:z.content?"border-destructive":""}),z.content&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:z.content.message})]})}),(0,r.jsx)(u.wL,{className:"pt-6 border-t",children:(0,r.jsx)(l.$,{type:"submit",disabled:e,size:"lg",className:"w-full sm:w-auto ml-auto bg-primary hover:bg-primary/90 text-primary-foreground",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.A,{className:"mr-2 h-5 w-5 animate-spin"}),"Sending..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{className:"mr-2 h-5 w-5"})," Send Message"]})})})]})]}):(0,r.jsxs)(u.Zp,{className:"max-w-xl mx-auto text-center py-12",children:[(0,r.jsxs)(u.aR,{children:[(0,r.jsx)(p.A,{className:"mx-auto h-10 w-10 text-destructive mb-3"}),(0,r.jsx)(u.ZB,{className:"text-destructive",children:"Coach Not Found"}),(0,r.jsx)(u.BT,{children:"The coach you are trying to message could not be found."})]}),(0,r.jsx)(u.Wu,{children:(0,r.jsx)(l.$,{asChild:!0,variant:"outline",children:(0,r.jsx)(j(),{href:"/browse-coaches",children:"Browse Coaches"})})})]}):(0,r.jsxs)(u.Zp,{className:"max-w-xl mx-auto text-center py-12",children:[(0,r.jsx)(u.aR,{children:(0,r.jsx)(u.ZB,{children:"Please Log In"})}),(0,r.jsxs)(u.Wu,{children:[(0,r.jsx)("p",{children:"You need to be logged in to send a message."}),(0,r.jsx)(l.$,{asChild:!0,className:"mt-4",children:(0,r.jsx)(j(),{href:`/login?redirect=${encodeURIComponent(`/messages/new?coachId=${encodeURIComponent(M||"")}`)}`,children:"Log In"})})]})]})}},43586:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var r=t(37413),a=t(61120),i=t(21608);let n=(0,t(3515).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function o(){return(0,r.jsxs)("div",{className:"flex justify-center items-center h-full min-h-[calc(100vh-200px)]",children:[(0,r.jsx)(n,{className:"h-12 w-12 animate-spin text-primary"}),(0,r.jsx)("span",{className:"ml-2",children:"Loading Page..."})]})}function l(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(o,{}),children:(0,r.jsx)(i.default,{})})}},44493:(e,s,t)=>{"use strict";t.d(s,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>n,aR:()=>o,wL:()=>u});var r=t(60687),a=t(43210),i=t(4780);let n=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));n.displayName="Card";let o=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...s}));o.displayName="CardHeader";let l=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));l.displayName="CardTitle";let d=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",e),...s}));d.displayName="CardDescription";let c=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",e),...s}));c.displayName="CardContent";let u=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",e),...s}));u.displayName="CardFooter"},55511:e=>{"use strict";e.exports=require("crypto")},55817:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(82614).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70440:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(31658);let a=async e=>[{type:"image/x-icon",sizes:"800x800",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},71544:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=t(65239),a=t(48088),i=t(88170),n=t.n(i),o=t(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(s,l);let d={children:["",{children:["messages",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,43586)),"/home/user/studio/src/app/messages/new/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,82893)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/user/studio/src/app/messages/new/page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/messages/new/page",pathname:"/messages/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},72963:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(82614).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},78148:(e,s,t)=>{"use strict";t.d(s,{b:()=>o});var r=t(43210),a=t(14163),i=t(60687),n=r.forwardRef((e,s)=>(0,i.jsx)(a.sG.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var o=n},79551:e=>{"use strict";e.exports=require("url")},80013:(e,s,t)=>{"use strict";t.d(s,{J:()=>d});var r=t(60687),a=t(43210),i=t(78148),n=t(24224),o=t(4780);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.b,{ref:t,className:(0,o.cn)(l(),e),...s}));d.displayName=i.b.displayName},81630:e=>{"use strict";e.exports=require("http")},85866:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(82614).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4447,2529,1658,2212,291],()=>t(71544));module.exports=r})();